@echo off
:: 切换编码防止乱码
chcp 65001 >nul

echo ==========================================
echo 正在进入安全启动模式...
echo ==========================================

:: 1. 无论是否安装，先尝试卸载冲突的旧库 (防止报错暂停，忽略错误)
echo [步骤 1/3] 清理旧版库冲突...
py -m pip uninstall google-generativeai -y >nul 2>&1

:: 2. 强制安装/更新正确的库 (google-genai)
echo [步骤 2/3] 安装/验证核心依赖...
py -m pip install google-genai gradio

:: 3. 启动
echo [步骤 3/3] 正在启动 webui.py ...
echo ------------------------------------------
py webui.py

:: 如果运行结束或报错，强制暂停，确保你能看到报错信息
echo.
echo ==========================================
echo 程序已停止运行。
echo 如上方有报错，请截图。
echo ==========================================
pause
